<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <RootNamespace>PogoAI</RootNamespace>
        <AssemblyName>PogoAI</AssemblyName>
        <TargetFramework>net472</TargetFramework>
        <LangVersion>8.0</LangVersion>
        <PlatformTarget>x64</PlatformTarget>
        <OutputPath>..\..\1.4\Assemblies</OutputPath>
        <Optimize>true</Optimize>
        <DebugType>pdbonly</DebugType>
        <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
        <GenerateTargetFrameworkAttribute>false</GenerateTargetFrameworkAttribute>
        <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
        <AppendTargetFrameworkToOutputPath>false</AppendTargetFrameworkToOutputPath>
        <ReleaseVersion>0.0.0.1</ReleaseVersion>
        <SynchReleaseVersion>false</SynchReleaseVersion>
        <Configurations>Release;Debug</Configurations>
    </PropertyGroup>
    <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'">
        <DebugSymbols>true</DebugSymbols>
        <OutputPath>..\..\1.4\Assemblies</OutputPath>
        <OutputPath>..\..\1.4\Assemblies</OutputPath>
        <DefineConstants>TRACE;NDEBUG</DefineConstants>
        <WarningLevel>4</WarningLevel>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
    </PropertyGroup>
    <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
        <OutputPath>..\..\1.4\Assemblies</OutputPath>
        <DefineConstants>TRACE;DEBUG_REACTION;DEBUG;NETFRAMEWORK;NET472;</DefineConstants>
        <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
        <TreatWarningsAsErrors>false</TreatWarningsAsErrors>
        <DebugType>full</DebugType>
    </PropertyGroup>
    <ItemGroup>
        <None Remove="Patches\" />
        <None Remove="Collections\" />
        <None Remove="Comps\" />
        <None Remove="Statistics\" />
        <None Remove="Deprecated\" />
        <None Remove="Defs\" />
        <None Remove="DefOfs\" />
        <None Remove="Cache\" />
    </ItemGroup>
    <!-- ................ -->
    <!--     Packages     -->
    <ItemGroup>
        <PackageReference Include="Krafs.Rimworld.Ref" Version="1.4.3580-beta" GeneratePathProperty="true" />
        <PackageReference Include="TaskPubliciser" Version="1.0.3" />
        <PackageReference Include="Mono.TextTransform" Version="1.0.0" GeneratePathProperty="true" ExcludeAssets="runtime" />
        <PackageReference Include="Lib.Harmony" Version="2.2.2" ExcludeAssets="runtime" />
        <PackageReference Include="Microsoft.NETCore.Platforms" Version="5.0.3" />
        <PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies.net472" Version="1.0.2">
            <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
            <PrivateAssets>all</PrivateAssets>
        </PackageReference>
    </ItemGroup>
    <!-- ................ -->
    <!-- Process T4 files -->
    <ItemGroup>
        <Compile Remove="ShadowCastingUtility.old.cs" />
    </ItemGroup>
    <Target Name="ProcessTT" BeforeTargets="BeforeBuild">
        <ItemGroup>
            <TTFiles Include="T4\Sources\*.tt" CopyToOutputDirectory="Never" />
        </ItemGroup>
        <PropertyGroup>
            <TextTransform>$(PkgMono_TextTransform)\tools\TextTransform.exe</TextTransform>
        </PropertyGroup>
        <Message Text="Processing T4 files: @(TTFiles->'%(Identity)')" />
    </Target>
    <!-- ................ -->
    <!--     Publisize    -->
    <Target Name="Publicise" BeforeTargets="UpdateReferences">
        <PropertyGroup>
            <!-- Just for now -->
            <AssemblyCSharp>$(PkgKrafs_Rimworld_Ref)\ref\net472\Assembly-CSharp.dll</AssemblyCSharp>
            <Unity_CoreModule>$(PkgKrafs_Rimworld_Ref)\ref\net472\UnityEngine.CoreModule.dll</Unity_CoreModule>
            <PubliciseOutputPath>$(PkgKrafs_Rimworld_Ref)\ref\net472\</PubliciseOutputPath>
            <AssemblyCSharp_Publicised>$(PubliciseOutputPath)Assembly-CSharp_publicised.dll</AssemblyCSharp_Publicised>
            <Unity_CoreModule_Publicised>$(PubliciseOutputPath)UnityEngine.CoreModule_publicised.dll</Unity_CoreModule_Publicised>
        </PropertyGroup>
        <!-- Publicise the dlls (if required) -->
        <Message Importance="High" Text="2.  Publicising Rimworld Assembly ..." />
        <Message Importance="High" Text="2.1 AssemblyCSharp Path ($(AssemblyCSharp))" />
        <Publicise TargetAssemblyPath="$(AssemblyCSharp)" OutputPath="$(PubliciseOutputPath)" Condition="Exists('$(AssemblyCSharp)')" />
        <Publicise TargetAssemblyPath="$(Unity_CoreModule)" OutputPath="$(PubliciseOutputPath)" Condition="Exists('$(Unity_CoreModule)')" />
        <!-- Add references to the new publicised dlls -->
        <Message Importance="High" Text="Replacing reference to un-publicised assemblies with publicised equivalents ..." />
        <ItemGroup>
            <Reference Include="$(AssemblyCSharp_Publicised)">
                <SpecificVersion>false</SpecificVersion>
                <HintPath>$(AssemblyCSharp_Publicised)</HintPath>
                <Implicit>true</Implicit>
                <Private>false</Private>
            </Reference>
            <Reference Include="$(Unity_CoreModule_Publicised)">
                <SpecificVersion>false</SpecificVersion>
                <HintPath>$(Unity_CoreModule_Publicised)</HintPath>
                <Implicit>true</Implicit>
                <Private>false</Private>
            </Reference>
        </ItemGroup>
    </Target>
    <Target Name="UpdateReferences" AfterTargets="ResolveLockFileReferences">
        <Message Importance="High" Text="3. Remove References at ($(PkgKrafs_Rimworld_Ref))" />
        <ItemGroup>
            <Reference Remove="$(PkgKrafs_Rimworld_Ref)\ref\net472\Assembly-CSharp.dll" />
            <Reference Remove="$(PkgKrafs_Rimworld_Ref)\ref\net472\UnityEngine.CoreModule.dll" />
        </ItemGroup>
    </Target>
    <PropertyGroup>
        <TransformOnBuild>false</TransformOnBuild>
    </PropertyGroup>
    <ProjectExtensions>
        <MonoDevelop>
            <Properties>
                <Policies>
                    <StandardHeader Text="&#xA;${FileName}&#xA; &#xA;Author:&#xA;      ${AuthorName} &lt;${AuthorEmail}&gt;&#xA;&#xA;Copyright (c) ${Year} ${CopyrightHolder}&#xA;&#xA;Permission is hereby granted, free of charge, to any person obtaining a copy&#xA;of this software and associated documentation files (the &quot;Software&quot;), to deal&#xA;in the Software without restriction, including without limitation the rights&#xA;to use, copy, modify, merge, publish, distribute, sublicense, and/or sell&#xA;copies of the Software, and to permit persons to whom the Software is&#xA;furnished to do so, subject to the following conditions:&#xA;&#xA;The above copyright notice and this permission notice shall be included in&#xA;all copies or substantial portions of the Software.&#xA;&#xA;THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR&#xA;IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,&#xA;FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE&#xA;AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER&#xA;LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,&#xA;OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN&#xA;THE SOFTWARE." IncludeInNewFiles="False" />
                </Policies>
            </Properties>
        </MonoDevelop>
    </ProjectExtensions>
</Project>